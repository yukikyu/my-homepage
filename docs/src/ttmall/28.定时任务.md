# 28.定时任务

## cron表达式

语法：秒 分 时 日 周 年（spring 不支持）

| 域名         | 必填 | 允许值           | 允许的特殊字符 |
| :----------- | :--- | :--------------- | :------------- |
| Seconds      | YES  | 0-59             | , - * /        |
| Minutes      | YES  | 0-59             | , - * /        |
| Hours        | YES  | 0-23             | , - * /        |
| Day of month | YES  | 1-31             | , - * ? / L W  |
| Month        | YES  | 1-12 or JAN-DEC  | , - * /        |
| Day of week  | YES  | 1-7 or SUN-SAT   | , - * ? / L #  |
| Year         | NO   | empty, 1970-2099 | , - * /        |

### 特殊字符

- `*`（“所有值”）- 用于选择字段中的所有值。例如，分钟字段中的“*”表示“每分钟”。

- `?` （“无特定值”）- 当您需要在允许字符的两个字段之一中指定某些内容时，而不是另一个字段中的内容时很有用。例如，如果我希望我的触发器在一个月的某一天（比如 10 号）触发，但不关心那一天是一周中的哪一天，我会将“10”放在当天-month 字段和“？”在星期字段中。请参阅下面的示例以进行说明。

- `-`  - 用于指定范围。例如，小时字段中的“10-12”表示“小时 10、11 和 12”。

- `,`  - 用于指定附加值。例如，星期字段中的“MON,WED,FRI”表示“星期一、星期三和星期五”。

- `/ ` - 用于指定增量。例如，秒字段中的“0/15”表示“秒 0、15、30 和 45”。秒字段中的“5/15”表示“秒 5、20、35 和 50”。您还可以在“”字符后指定“/”——在这种情况下，“”相当于在“/”之前有“0”。月份字段中的“1/3”表示“从当月的第一天开始每 3 天触发一次”。

- `L` -（“last”） - 在允许它的两个字段中的每一个中都有不同的含义。例如，月份字段中的值“L”表示“月份的最后一天”——非闰年的一月为 31 天，二月为 28 天。如果单独用于“星期几”字段，则仅表示“7”或“SAT”。但如果在day-of-week 字段中使用另一个值，则表示“该月的最后xxx 天”——例如“6L”表示“该月的最后一个星期五”。您还可以指定与该月最后一天的偏移量，例如“L-3”，表示日历月的倒数第三天。使用“L”选项时，重要的是不要指定列表或值范围，因为您会得到令人困惑/意外的结果。

- `W` -（“工作日”） - 用于指定离给定日期最近的工作日（周一至周五）。例如，如果您将“15W”指定为 day-of-month 字段的值，则其含义为：“距该月 15 日最近的工作日”。因此，如果 15 日是星期六，触发器将在 14 日星期五触发。如果 15 日是星期日，触发器将在 16 日星期一触发。如果 15 号是星期二，那么它将在 15 号星期二触发。但是，如果您将“1W”指定为月份中的某天的值，并且 1 号是星期六，则触发器将在 3 号星期一触发，因为它不会“跳过”一个月的天数边界。 “W”字符只能在月中的某一天是一天时指定，而不是日期范围或列表。

> 'L' 和 'W' 字符也可以在 day-of-month 字段中组合以产生 'LW'，它转换为 *“一个月的最后一个工作日”*。

- `#` - 用于指定该月的“第 n”XXX 天。例如，星期几字段中“6#3”的值表示“本月的第三个星期五”（第 6 天 = 星期五，“#3” = 当月的第三个星期五）。其他示例：“2#1” = 每月的第一个星期一，“4#5” = 每月的第五个星期三。请注意，如果您指定“#5”并且该月中给定的星期几没有 5，则该月将不会触发。

### 案例

| 例子                       | 解释                                                         |
| -------------------------- | ------------------------------------------------------------ |
| `0 0 12 * * ?`             | 每天中午 12 点（中午）触发                                   |
| `0 15 10 ? * *`            | 每天上午 10 点 15 分开火                                     |
| `0 15 10 * * ?`            | 每天上午 10 点 15 分开火                                     |
| `0 15 10 * * ? *`          | 每天上午 10 点 15 分开火                                     |
| `0 15 10 * * ? 2005`       | 2005 年每天上午 10:15 触发                                   |
| `0 * 14 * * ?`             | 每天从下午 2 点开始到下午 2:59 结束，每分钟触发一次          |
| `0 0/5 14 * * ?`           | 每天从下午 2 点开始到下午 2:55 结束，每 5 分钟触发一次       |
| `0 0/5 14,18 * * ?`        | 每天从下午 2 点开始到下午 2:55 每 5 分钟触发一次，从下午 6 点开始到下午 6:55 结束每 5 分钟触发一次 |
| `0 0-5 14 * * ?`           | 每天从下午 2 点开始到下午 2:05 结束，每分钟触发一次          |
| `0 10,44 14 ? 3 WED`       | 在三月的每个星期三下午 2:10 和下午 2:44 触发。               |
| `0 15 10 ? * MON-FRI`      | 每周一、周二、周三、周四和周五上午 10:15 触发                |
| `0 15 10 15 * ?`           | 在每个月的第 15 天的上午 10:15 触发                          |
| `0 15 10 L * ?`            | 在每个月的最后一天的上午 10:15 触发                          |
| `0 15 10 L-2 * ?`          | 在每月倒数第二天的上午 10:15 触发                            |
| `0 15 10 ? * 6L`           | 在每个月的最后一个星期五上午 10:15 触发                      |
| `0 15 10 ? * 6L`           | 在每个月的最后一个星期五上午 10:15 触发                      |
| `0 15 10 ? * 6L 2002-2005` | 在 2002、2003、2004 和 2005 年期间每个月的最后一个星期五的上午 10:15 触发 |
| `0 15 10 ? * 6#3`          | 在每个月的第三个星期五上午 10:15 触发                        |
| `0 0 12 1/5 * ?`           | 从每月的第一天开始，每个月每 5 天在中午 12 点（中午）触发一次。 |
| `0 11 11 11 11 ?`          | 每年 11 月 11 日上午 11:11 触发。                            |

